<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="top.zzh.dao.UserDAO">

    <resultMap id="userMap" type="user">

    </resultMap>

    <select id="getByNamePwd" resultMap="userMap">
        select uid,uname,state from t_user
        where uname=#{name}
        and upwd =#{pwd}
    </select>

    <select id="getByPhone" resultMap="userMap">
        select uid,uname,state from t_user
        where phone=#{phone}
    </select>



    <insert id="register" parameterType="user">

        <selectKey keyColumn="uid" keyProperty="uid" resultType="long" order="AFTER">
            SELECT LAST_INSERT_ID()
        </selectKey>
        <![CDATA[
           insert into t_user (uname,upwd,phone,tzm,tid,state,idtype,isvip)  VALUES(#{uname},#{upwd},#{phone},#{tzm},#{tid},1,'身份证',1)
        ]]>
    </insert>


    <update id="saveHeader" parameterType="string">
        <![CDATA[
           update t_user set face=#{face} where uname=#{uname}
        ]]>
    </update>

    <select id="getByface" resultMap="userMap">
        select uid,uname,face from t_user
        where uname=#{uname}
    </select>


    <update id="updateZpwd" parameterType="string">
        <![CDATA[
           update t_user set zpwd=#{zpwd} where uname=#{uname}
        ]]>
    </update>

    <select id="getByZpwd" resultType="string">
        select zpwd from t_user
        where uname=#{uname}
    </select>


    <select id="getById" resultMap="userMap">
        select uname,upwd,phone,tzm,idtype,idno,email,rname,face,sex,isvip,create_time from t_user
        where uid=#{uid}
    </select>

    <update id="update" parameterType="user">
        <![CDATA[
           update t_user set phone=#{phone},idno=#{idno},email=#{email},
            rname=#{rname},sex=#{sex}  where uname=#{uname}
        ]]>
    </update>

    <update id="updateUpwd">
        <![CDATA[
           update t_user set upwd=#{upwd}  where uid=#{uid}
        ]]>
    </update>

</mapper>